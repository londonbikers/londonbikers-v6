using System.Text.RegularExpressions;
using Microsoft.VisualStudio.TestTools.UnitTesting;

namespace MigratorTests
{
    [TestClass]
    public class FormattingTests
    {
        [TestMethod]
        public void MultipleNewLinesTest()
        {
            const string input = "Hi all,<br/><br/><div>I know this is not the stolen section, but since it's an adventure and offroad section, I hope that someone will know any information on adventure races etc.&nbsp;<br/><br/><div>My KTM 950 Adventure was stolen last Monday - by professionals since it was locked inside the building with a chain and a disc lock with alarm- &nbsp;and one of the things that cross my mind is that it will be striped down and used to races, if not sent abroad. So if you are aware of any races taking place, please do let me know.<br/><br/><div>It was stolen in N17 area of London, near White Heart Lane stadium.<br/><br/><div>It had Greek licence plates so the insurance won't pay anything because it was stolen outside of Greece and they don't cover it.<br/><br/><div>If you have any information or see anything please let me know. £2000 will be given to information that will lead to the bike.<br/><br/><div>Contact: 07526919406 Dimitris &nbsp; &nbsp; &nbsp;- Many thanks!<br/><br/><div><img src=\"http://londonbikers.com/forums/imagesv5/7feb73c8-d132-4e00-ad63-2b57.jpg\" alt=\"http://londonbikers.com/forums/imagesv5/7feb73c8-d132-4e00-ad63-2b57.jpg\" />";
            var output = Migrator.Program.RemoveUnwantedMessageFormatting(input);
            Assert.IsFalse(output.Contains("\r\n\r\n\r\n"));
        }   

        [TestMethod]
        public void MultipleNewLinesTest2()
        {
            const string input = "I fitted the Throttle Mod to my GSXR 750 Yesterday. Due to the rain couldn't test it out.<br/><br/>&nbsp;<br/><br/>Just been for a little blast and....................OH MY GOD!!!!!!<br/><br/>&nbsp;<br/><br/>Whjy didn't Suzuki fit these as standard??????<br/><br/>&nbsp;<br/><br/>The throttle response is so much better, it picks up so much quicker and feels faster!!!<br/><br/>&nbsp;<br/><br/>It was £25 from Biker Discount Store and is basically a clip that goes over the throttle Tube making the throttle cables Toughter, this in turn means that a smaller twist of the throttle opens the throttle sooner (1/5th less) and gets the power down quicker.&nbsp;It is a little jerky in first but i will get used to the difference and that will smooth out in a day or two. I know the bike is not any faster but it feels it as it is getting that power on that little bit quicker so it is more responsive from the throttle.<br/><br/>&nbsp;<br/><br/>It is a very easy instilation and took about 30 Mins. If you are a Basic DIY Mechanic it should be very straight forward.<br/><br/>I would suggest though, if you have never done a Throttle adjustment on a bike before then i would get someone who has to either give you a hand or show you how to do it/do it for you.<br/><br/>I didn't take any pics so these are Google images and not my own, but gives you an idea of what needs to be done.<br/><br/>&nbsp;<br/><br/>First off here is the Item.<br/><br/><img src=\"http://londonbikers.com/forums/imagesv5/0f36ea82-8e89-4949-8c2c-4bd1.png\"/><br/><br/><img src=\"http://londonbikers.com/forums/imagesv5/e5856754-27da-487a-a174-44c8.png\"/><br/><br/>It fits onto the throttle tube as such..<br/><br/><img src=\"http://londonbikers.com/forums/imagesv5/99b21b22-f1b3-4dd6-84ee-dbb6.png\"/>";
            var output = Migrator.Program.RemoveUnwantedMessageFormatting(input);
            Assert.IsFalse(output.Contains("\r\n\r\n\r\n"));
        }

        [TestMethod]
        public void RetainIframesTest()
        {
            const string input = "<span id=\"docs-internal-guid-561e108e-65af-f339-fb14-8eb29fb5733b\"><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Offered on here before eBay etc.</span></p><br/><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Looking for £3,750. Open to reasonable offers.</span></p><br/><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">2008 Kawasaki ZX6R P8F Green</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">16,596 miles (will increase as still being used)</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Tax expires 01/05/2015</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">MOT expires 02/07/2015</span></p><br/><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Akrapovic slip-on exhaust, dealer fitted from new.</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">R&amp;G crash bungs, fork protectors, cotton reels, bar ends, tailtidy.</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Dark double bubble screen.</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Side stand from G2 ZX6R (less vertical lean angle), have original.</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Was on private plate but will be returned to original 08 plate.</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Seat cowl included</span></p><br/><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Owned since 27/05/2013; I am the second owner . I bought this from a work colleague who purchased it new on 01/05/2008, he rode it for 3,182 miles and then it spent a few years SORN in a garage. History as below:</span></p><br/><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">01/05/2008 - Purchased new by first owner.</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">11/06/2008 @ 688 miles - First service. Receipt and stamp in service book.</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">I don’t know when it was SORN for the first time.</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">01/05/2011 - SORN with DVLA acknowledgement letter</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">01/05/2012 - SORN with DVLA acknowledgement letter</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">27/05/2013 @ 3,182 miles - Purchased by me (still SORN). Rob Brown worked his magic as it had been sitting in a garage for over two years. New battery, oil and filters, brake fluid.</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">30/05/2013 @ 3,182 miles - MOT (no advisories)</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">16/08/2013 @ 5,848 miles - New Michelin Pilot Road 3 tyres front and rear at Essential Rubber (receipt)</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">21/09/2013 - Replaced radiator fan (receipt for labour)</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">26/11/2013 @ 9,290 miles - Service by Rob Brown including oil, filter, rear brake pads and removal of Datatool alarm (receipt for parts)</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Some point here I have replaced the front brake pads with Goldfren pads which lasted less than 2,000 miles, then genuine Kawasaki front pads as below (the Goldfren pads were pants).</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">06/03/2014 - Genuine front and rear brake pads, fitted by myself (receipt for parts)</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">15/04/2014 @ 14,292 miles - Service by P&amp;H Motorcycles including Kawasaki recall for leaking gasket cover (receipt for service)</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">03/07/2014 @ 15,065 miles - MOT (one advisory for crack in numberplate, this was private plate legal size MOT one which has now been changed anyway)</span></p><br/><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">“Bad” bits (I’m being honest):</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Tyres have lost their shape a little and will need changing in the near future (they've done over 10,000 miles).</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">I don’t have the original exhaust or the baffle for the Akrapovic (passes MOT)</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Kept in garage at home and at work, but I have used the bike for year round for commuting; wear and tear associated with use such as heel guards are marked, some bolts show signs of salt, few marks etc.</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Right crash bung and mirror show minor signs of damage, bike has fallen off side stand (hence replaced side stand with more lean)</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Was involved in a low speed (less than 10mph) off in April, insurance repaired tank and rear fairing including respray of these parts. Bodywork overall is in excellent condition.</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Small rubber grommit thing that covers the left mirror nut has fallen off.</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Some of the black decal has worn off on the fairings (see pics). This is a decal, not paint.</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">The tax disc holder has rubbed the paint from the swingarm.</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\"><br/></span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Mileage will increase as I’m still using it to commute. Selling as it’s a little cramped for me, change in jobs has meant my commute has reduced and most of my riding is in town and I really, really, really really want a Supermoto. Willing to bring to Ace/BM/Blackheath/Sunday ride for people to see. Based in BR6 Orpington.</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\"><br/></span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\">Hopefully pics embedded correctly below:</span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\"><br/></span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><span style=\"font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap;\"><br/></span></p><p dir=\"ltr\" style=\"line-height:1.15;margin-top:0pt;margin-bottom:0pt;\"><iframe src=\"https://www.flickr.com/photos/32409907@N00/15022330979/in/photostream/player/\" width=\"800\" height=\"532\" frameborder=\"0\" allowfullscreen=\"\" webkitallowfullscreen=\"\" mozallowfullscreen=\"\" oallowfullscreen=\"\" msallowfullscreen=\"\"></iframe></p><div><br/><br/><div><span><br/><br/><br/></span></span>";
            var output = Migrator.Program.RemoveUnwantedMessageFormatting(input);
            Assert.IsTrue(output.Contains("<iframe"));
        }

        [TestMethod]
        public void YouTubeObjectConversionTest()
        {
            const string input = "<object width=\"425\" height=\"344\"><param name=\"movie\" value=\"http://www.youtube.com/v/k0lcGXh57cg&hl=en&fs=1&\"></param><param name=\"allowFullScreen\" value=\"true\"></param><param name=\"allowscriptaccess\" value=\"always\"></param><embed src=\"http://www.youtube.com/v/k0lcGXh57cg&hl=en&fs=1&\" type=\"application/x-shockwave-flash\" allowscriptaccess=\"always\" allowfullscreen=\"true\" width=\"425\" height=\"344\"></embed></object>";
            var output = Migrator.Program.RemoveUnwantedMessageFormatting(input);
            Assert.IsTrue(Regex.IsMatch(output, @"\[YouTube\]https://www.youtube\.com(?:.*?)\[/YouTube\]", RegexOptions.IgnoreCase));
        }

        [TestMethod]
        public void WeirdLineReturnsTest()
        {
            const string input = @"Went down to Southampton today to pick up my new ride. <br>
<br>
Kawasaki er6f 2006. Picked it up for £2300, with 11,000 on the clock. Today was the first time ive been back on a bike since my first off a few months ago where I went piling into a BMW's boot!<br>
<br>
<br>
<br>
Was quite a tough ride back today. Loadsa motorway riding, cold wind, and patches of rain. New bike maybe, but still couldn't wait to get home and warm!...<br>
<br>
Well after less than a day, I've realised I'm going to buy some aftermarket sports handlebars. I'm not a big fan of how the handlebars sit (bit too high for my liking). Found somewhere in America that ships them. Would Kawsaki dealers fit it for me if I turn up with it, or is there cheaper places?<br>
<br>
Its great to be back and riding again. I've already learnt a lot from my last off. The gap between me and the car in front has now increased substantially, and im very cautious about it! Either way, love my new bike!!";
            var output = Migrator.Program.RemoveUnwantedMessageFormatting(input);
            var containsExcessNewLines = output.Contains("\r\n\n\r\n\n");
            Assert.IsFalse(containsExcessNewLines);
        }

        [TestMethod]
        public void WeirdLineReturnsTest2()
        {
            const string input =
                @"my dad is after another bike his 1999 fazer 600 has got to 30k and its being a pain to run in the winter so hes after something abit younger and more reliable.<br>
<br>
he would love a fazer 1000 or something similar as he likes the power of the 600 but wants that bit more like when he had a cb900. <br>
<br>
it cant have clip on bars as his back hurts and must be able to have a top box fitted for his tools";
            var output = Migrator.Program.RemoveUnwantedMessageFormatting(input);
            var containsExcessNewLines = output.Contains("\r\n\n\r\n\n");
            Assert.IsFalse(containsExcessNewLines);
        }

        //[TestMethod]
        //public void CorruptButWorkingVideoEmbedTest()
        //{
        //    // this video displays fine, despite the html not having an opening object tag.
        //    // http://londonbikers.com/forums/654636/Crazy-supermoto-video
        //    const string input ="<PARAM name=\"movie\" value=\"http://www.youtube.com/v/_r-1t6D5E6U&amp;hl=en_GB&amp;fs=1&amp;rel=0\"></PARAM><PARAM name=\"allowFullScreen\" value=\"true\"></PARAM><PARAM name=\"allowscriptaccess\" value=\"always\"></PARAM><EMBED height=505 type=application/x-shockwave-flash width=640 src=http://www.youtube.com/v/_r-1t6D5E6U&amp;hl=en_GB&amp;fs=1&amp;rel=0 allowscriptaccess=\"always\" allowfullscreen=\"true\"></EMBED></OBJECT>&gt;";
        //    var output = Migrator.Program.RemoveUnwantedMessageFormatting(input);
        //    Assert.AreEqual(input, output);
        //}
    }
}